<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¹¼å…’åœ’æ•™ä¿æ´»å‹•èª²ç¨‹å¤§ç¶± - å­¸ç¿’æŒ‡æ¨™</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", Arial, sans-serif;
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    .domain-section {
      margin-bottom: 60px;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .domain-title {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 20px;
      color: #333;
      border-bottom: 3px solid #8db255;
      padding-bottom: 10px;
    }
    
    .summary-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
    }
    
    .summary-table th {
      background-color: #8db255;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 18px;
      border: 1px solid #7ba044;
    }
    
    .summary-table td {
      border: 1px solid #ddd;
      padding: 15px;
      vertical-align: top;
    }

    /* ç©ºçš„è¡¨æ ¼å–®å…ƒæ ¼é¡¯ç¤ºæ·±ç°è‰²èƒŒæ™¯ */
    .summary-table td:empty,
    .summary-table td.empty-cell {
      background-color: #e8e8e8;
    }
    
    .summary-table .ability-cell {
      background-color: #e8f1d4;
      font-weight: bold;
      text-align: center;
      width: 150px;
      vertical-align: middle;
    }
    
    .summary-table .goal-code {
      font-weight: bold;
      color: #2c5282;
      margin-right: 8px;
    }

    .summary-cell-item {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
    }

    .summary-cell-item:last-child {
      margin-bottom: 0;
    }

    .goal-desc {
      line-height: 1.6;
    }

    /* æœ‰ colspan çš„å–®å…ƒæ ¼æ°´å¹³å‚ç›´ç½®ä¸­ */
    .summary-table td[colspan] {
      text-align: center !important;
      vertical-align: middle !important;
    }

    /* æœ‰ colspan çš„å…§å®¹ä¹Ÿè¦ç½®ä¸­ */
    .summary-table td[colspan] .summary-cell-item {
      justify-content: center;
    }

    /* æœ‰ rowspan çš„å–®å…ƒæ ¼å‚ç›´ç½®ä¸­ */
    .summary-table td[rowspan] {
      vertical-align: middle !important;
    }

    /* æ²’æœ‰ colspan çš„å–®å…ƒæ ¼é å·¦å°é½Š */
    /* .summary-table td:not([colspan]) {
      text-align: left;
      vertical-align: top;
    } */

    /* å°è§’ç·šè¡¨é ­æ¨£å¼ */
    .diagonal-header {
      background-image: linear-gradient(to bottom left,
        transparent 0%,
        transparent calc(50% - 0.8px),
        #7ba044 calc(50% - 0.8px),
        #7ba044 calc(50% + 0.8px),
        transparent calc(50% + 0.8px),
        transparent 100%);
      position: relative;
      padding: 20px !important;
      min-width: 150px;
      min-height: 80px;
    }

    .diagonal-header .top-right {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 16px;
      line-height: 1.3;
      text-align: right;
    }

    .diagonal-header .bottom-left {
      position: absolute;
      bottom: 10px;
      left: 15px;
      font-size: 16px;
      line-height: 1.3;
    }
    
    .detail-title {
      font-size: 22px;
      font-weight: bold;
      margin: 30px 0 15px 0;
      color: #2c5282;
    }
    
    .detail-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    
    .detail-table th {
      background-color: #4a7ba7;
      color: white;
      padding: 10px 8px;
      text-align: center;
      border: 1px solid #3a6b97;
      font-size: 15px;
    }
    
    .detail-table td {
      border: 1px solid #ddd;
      padding: 12px 10px;
      vertical-align: top;
      font-size: 14px;
      line-height: 1.6;
    }
    
    .detail-table .goal-col {
      font-weight: bold;
      color: #2c5282;
      text-align: center;
      width: 180px;
      background-color: #f9f9f9;
      vertical-align: middle;
    }
    
    .detail-table .desc-col {
      background-color: #fafafa;
    }

    /* ç©ºçš„ desc-col é¡¯ç¤ºæ·±ç°è‰²èƒŒæ™¯ */
    .desc-col:empty,
    .desc-col.empty-cell {
      background-color: #e8e8e8;
    }

    .detail-table .goal-code {
      font-size: 16px;
      margin-bottom: 6px;
    }

    .detail-table .goal-desc {
      font-weight: normal;
      color: #333;
      line-height: 1.6;
    }

    .indicator-cell {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .indicator-code {
      font-weight: bold;
      color: #2c5282;
    }
    
    .indicator-desc {
      color: #444;
      line-height: 1.6;
    }
    
    .age-header {
      background-color: #5a8bb7 !important;
    }
    
    .goal-group {
      background-color: #f0f0f0;
    }

    .status-message {
      text-align: center;
      font-size: 18px;
      color: #555;
      padding: 40px 0;
    }

    .status-error {
      color: #c53030;
    }

    .goal-group-last {
      border-bottom: 3px solid #cbd5e0 !important;
    }

    /* ç®­é ­æŒ‡æ¨™æ¨£å¼ */
    .detail-table .desc-col.arrow-cell {
      padding: 0;
      vertical-align: middle;
      position: relative;
    }

    .arrow-indicator {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      width: 80%;
      height: 100%;
      padding: 12px 10px;
    }

    .arrow-indicator::before {
      content: '';
      flex: 1;
      height: 3px;
      background: linear-gradient(to right, #02a568 0%, #03c87e 100%);
      margin-right: 0;
    }

    .arrow-indicator::after {
      content: 'â–¶';
      color: #02a568;
      font-size: 16px;
      font-weight: bold;
      line-height: 1;
      margin-left: -2px;
    }

    /* è¤‡è£½æŒ‰éˆ•æ¨£å¼ */
    .desc-col {
      position: relative;
    }

    .copy-button {
      position: absolute;
      top: 4px;
      right: 4px;
      background-color: #4a7ba7;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 6px;
      width: 28px;
      height: 28px;
      font-size: 14px;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.2s, background-color 0.2s;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .detail-table td:hover .copy-button {
      opacity: 1;
    }

    .copy-button:hover {
      background-color: #3a6b97;
    }

    .copy-button:active {
      background-color: #2c5282;
    }

    /* Toast æç¤ºæ¨£å¼ */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #48bb78;
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1002; /* é«˜æ–¼å‰ªè²¼ç°¿çš„ 1001 */
      animation: slideIn 0.3s ease-out, slideOut 0.3s ease-in 2.7s;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(400px);
        opacity: 0;
      }
    }

    /* åº•éƒ¨å·¥å…·åˆ—æ¨£å¼ - ç»ç’ƒè³ªæ„Ÿ */
    .floating-toolbar {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 24px;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1), 0 2px 8px rgba(0, 0, 0, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.3);
      z-index: 999;
      transition: all 0.3s ease;
    }

    /* ç•¶åµŒå…¥åœ¨ iframe ä¸­æ™‚ï¼Œèª¿æ•´å·¥å…·åˆ—ä½ç½® */
    body.in-iframe .floating-toolbar {
      bottom: 80px; /* å¢åŠ åº•éƒ¨é–“è·é¿å…è¢«çˆ¶é é¢å…ƒç´ é®æ“‹ */
    }

    /* iPad ç‰¹å®šèª¿æ•´ï¼ˆä½¿ç”¨åª’é«”æŸ¥è©¢æª¢æ¸¬è§¸æ§è¨­å‚™ï¼‰ */
    @media (hover: none) and (pointer: coarse) {
      body.in-iframe .floating-toolbar {
        bottom: 100px; /* iPad ç­‰è§¸æ§è¨­å‚™éœ€è¦æ›´å¤šç©ºé–“ */
      }
    }

    .floating-toolbar:hover {
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15), 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    /* å°èˆªé¸å–® */
    .nav-select {
      padding: 8px 16px;
      border: 1px solid rgba(141, 178, 85, 0.3);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.9);
      color: #333;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      outline: none;
      transition: all 0.2s;
      min-width: 200px;
    }

    .nav-select:hover {
      border-color: #8db255;
      background: white;
    }

    .nav-select:focus {
      border-color: #8db255;
      box-shadow: 0 0 0 3px rgba(141, 178, 85, 0.1);
    }

    /* å‰ªè²¼ç°¿æŒ‰éˆ• */
    .clipboard-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: linear-gradient(135deg, #02a568 0%, #03c078 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(2, 165, 104, 0.2);
    }

    .clipboard-btn:hover {
      background: linear-gradient(135deg, #019456 0%, #02a568 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(2, 165, 104, 0.3);
    }

    .clipboard-btn:active {
      transform: translateY(0);
    }

    .clipboard-btn .badge {
      background: rgba(255, 255, 255, 0.3);
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: bold;
    }
    
    .clipboard-btn svg {
      width: 18px;
      height: 18px;
      fill: white;
    }

    /* å‰ªè²¼ç°¿ Modal - å¾æŒ‰éˆ•ä½ç½®å¾€ä¸Šæµ®å‡º */
    .clipboard-modal {
      display: none;
      position: fixed;
      z-index: 1001;
    }

    .clipboard-modal.show {
      display: block;
    }

    .clipboard-content {
      position: fixed;
      /* ä½ç½®å°‡ç”± JavaScript å‹•æ…‹è¨­ç½® */
      background: white;
      border-radius: 16px;
      padding: 20px;
      width: 500px;
      max-width: calc(100vw - 40px);
      max-height: 60vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      animation: slideUpFromButton 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      transform: translate(-50%, -100%); /* ä»¥ä¸­å¿ƒé»ç‚ºåŸºæº–ï¼Œå‘ä¸Šåç§» */
      margin-top: -20px; /* è·é›¢æŒ‰éˆ•çš„é–“è· */
    }

    @keyframes slideUpFromButton {
      from {
        transform: translate(-50%, calc(-100% + 20px)) scale(0.95);
        opacity: 0;
      }
      to {
        transform: translate(-50%, -100%) scale(1);
        opacity: 1;
      }
    }

    @keyframes slideDownToButton {
      from {
        transform: translate(-50%, -100%) scale(1);
        opacity: 1;
      }
      to {
        transform: translate(-50%, calc(-100% + 20px)) scale(0.95);
        opacity: 0;
      }
    }

    .clipboard-modal.closing .clipboard-content {
      animation: slideDownToButton 0.2s cubic-bezier(0.32, 0, 0.67, 0) forwards;
    }

    .clipboard-header {
      display: none; /* éš±è—æ¨™é¡Œå€åŸŸ */
    }

    .clipboard-list {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      margin-bottom: 12px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
    }
    
    .clipboard-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    
    .clipboard-table thead {
      display: none; /* éšè—è¡¨å¤´ */
    }
    
    .clipboard-table th {
      padding: 12px 16px;
      text-align: left;
      font-weight: 600;
      color: #495057;
      border-bottom: 2px solid #dee2e6;
      white-space: nowrap;
    }
    
    .clipboard-table th:first-child {
      width: 40px;
      text-align: center;
    }
    
    .clipboard-table td {
      padding: 12px 16px;
      border-bottom: 1px solid #e9ecef;
      color: #212529;
      line-height: 1.5;
      word-wrap: break-word;
      word-break: break-word;
    }
    
    .clipboard-table td:first-child {
      width: 40px;
      text-align: center;
      color: #6c757d;
      font-weight: 500;
      background: #f8f9fa;
    }
    
    .clipboard-table tbody tr {
      transition: background-color 0.15s ease;
      cursor: pointer;
    }
    
    .clipboard-table tbody tr:hover {
      background-color: #f1f9f5;
    }
    
    .clipboard-table tbody tr:active {
      background-color: #e6f4ed;
    }
    
    .clipboard-table tbody tr:last-child td {
      border-bottom: none;
    }

    .clipboard-empty {
      text-align: center;
      padding: 40px;
      color: #a0aec0;
      font-size: 16px;
    }

    .clipboard-empty-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    .clipboard-actions {
      display: flex;
      gap: 8px;
    }

    .clipboard-action-btn {
      flex: 1;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .copy-all-btn {
      background: linear-gradient(135deg, #02a568 0%, #03c078 100%);
      color: white;
    }

    .copy-all-btn:hover {
      background: linear-gradient(135deg, #019456 0%, #02a568 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(2, 165, 104, 0.3);
    }

    .clear-btn {
      background: #e2e8f0;
      color: #4a5568;
    }

    .clear-btn:hover {
      background: #cbd5e0;
    }

    .clipboard-action-btn:active {
      transform: translateY(0);
    }

    .clipboard-action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* å¯é»æ“Šçš„èª²ç¨‹ç›®æ¨™æ¨£å¼ */
    .clickable-goal {
      transition: all 0.2s ease;
      border-radius: 4px;
      padding: 2px 4px;
      margin: -2px -4px;
    }

    .clickable-goal:hover {
      background-color: rgba(59, 130, 246, 0.1);
      transform: scale(1.02);
    }

    .clickable-goal:active {
      background-color: rgba(59, 130, 246, 0.2);
      transform: scale(0.98);
    }

    /* é«˜äº®å‹•ç•« */
    .highlight-goal {
      animation: highlightPulse 2s ease-out;
    }

    @keyframes highlightPulse {
      0% {
        background-color: rgba(59, 130, 246, 0.3);
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);
      }
      50% {
        background-color: rgba(59, 130, 246, 0.2);
        box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
      }
      100% {
        background-color: transparent;
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
      }
    }
  </style>
</head>
<body>
  <main id="app">
    <div class="status-message">è³‡æ–™è¼‰å…¥ä¸­</div>
  </main>

  <!-- åº•éƒ¨æ‚¬æµ®å·¥å…·åˆ— -->
  <div class="floating-toolbar">
    <select class="nav-select" id="domainNav">
      <option value="">é¸æ“‡é ˜åŸŸ...</option>
    </select>
    <button class="clipboard-btn" id="clipboardBtn">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 16H5V5h2v3h10V5h2v14z"/>
      </svg>
      <span class="badge" id="clipboardCount">0</span>
    </button>
  </div>

  <!-- å‰ªè²¼ç°¿ Modal -->
  <div class="clipboard-modal" id="clipboardModal">
    <div class="clipboard-content">
      <div class="clipboard-list" id="clipboardList">
        <div class="clipboard-empty">
          <div class="clipboard-empty-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width: 48px; height: 48px; fill: #cbd5e0;">
              <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 16H5V5h2v3h10V5h2v14z"/>
            </svg>
          </div>
          <div>å°šæœªè¤‡è£½ä»»ä½•æŒ‡æ¨™</div>
        </div>
      </div>
      <div class="clipboard-actions">
        <button class="clipboard-action-btn copy-all-btn" id="copyAllBtn" disabled>
          ğŸ“„ å…¨éƒ¨è¤‡è£½
        </button>
        <button class="clipboard-action-btn clear-btn" id="clearBtn" disabled>
          ğŸ—‘ï¸ æ¸…ç©º
        </button>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const DATA_URL = 'data/learning_indicators.json';
      const DETAIL_TITLE_TEXT = 'å„å¹´é½¡å±¤å­¸ç¿’æŒ‡æ¨™';
      const app = document.getElementById('app');
      
      // å‰ªè²¼ç°¿æ­·å²è¨˜éŒ„
      let clipboardHistory = [];
      
      // é ˜åŸŸå€å¡Šåƒè€ƒ
      let domainSections = [];

      // æª¢æ¸¬æ˜¯å¦åœ¨ iframe ä¸­ï¼ˆä¾‹å¦‚åµŒå…¥åœ¨ Google Siteï¼‰
      detectIframeEnvironment();

      init();

      function detectIframeEnvironment() {
        try {
          // æª¢æ¸¬æ˜¯å¦åœ¨ iframe ä¸­
          if (window.self !== window.top) {
            // åœ¨ iframe ä¸­ï¼Œæ·»åŠ æ¨™è¨˜é¡
            document.body.classList.add('in-iframe');
            
            // å¯é¸ï¼šå˜—è©¦æª¢æ¸¬æ˜¯å¦æ˜¯ Google Siteï¼ˆå¯èƒ½å› è·¨åŸŸé™åˆ¶è€Œå¤±æ•—ï¼‰
            try {
              const parentUrl = window.parent.location.href;
              if (parentUrl && (parentUrl.includes('sites.google.com') || parentUrl.includes('google.com/site'))) {
                document.body.classList.add('in-google-site');
              }
            } catch (e) {
              // è·¨åŸŸé™åˆ¶ï¼Œç„¡æ³•è¨ªå•çˆ¶é é¢ URL
              // é€™æ˜¯æ­£å¸¸æƒ…æ³ï¼Œä¸å½±éŸ¿åŠŸèƒ½
            }
          }
        } catch (e) {
          console.log('ç„¡æ³•æª¢æ¸¬ iframe ç’°å¢ƒ:', e);
        }
      }

      async function init() {
        try {
          const data = await fetchData();
          clearApp();
          renderDomains(Array.isArray(data.domains) ? data.domains : []);
        } catch (error) {
          showStatus(`è³‡æ–™è¼‰å…¥å¤±æ•—ï¼š${error.message}`, true);
        }
      }

      function clearApp() {
        app.innerHTML = '';
      }

      function showStatus(message, isError = false) {
        clearApp();
        const status = document.createElement('div');
        status.className = 'status-message' + (isError ? ' status-error' : '');
        status.textContent = message;
        app.appendChild(status);
      }

      async function fetchData() {
        const response = await fetch(DATA_URL, { cache: 'no-store' });
        if (!response.ok) {
          throw new Error(`${response.status} ${response.statusText}`);
        }
        return response.json();
      }

      function renderDomains(domains) {
        if (!domains.length) {
          showStatus('å°šæœªæä¾›å­¸ç¿’æŒ‡æ¨™è³‡æ–™ã€‚', true);
          return;
        }

        domainSections = []; // æ¸…ç©º
        domains.forEach((domain) => {
          const domainElement = renderDomain(domain);
          app.appendChild(domainElement);
          domainSections.push({
            name: domain.title || domain.name || 'æœªå‘½åé ˜åŸŸ',
            element: domainElement
          });
        });
        
        // åˆå§‹åŒ–å·¥å…·åˆ—
        initToolbar();
        
        // åˆå§‹åŒ–æ—¶æ£€æµ‹å½“å‰ä½ç½®
        updateCurrentDomain();
      }

      function renderDomain(domain) {
        const section = document.createElement('section');
        section.className = 'domain-section';

        const title = document.createElement('div');
        title.className = 'domain-title';
        title.textContent = domain.title || '';
        section.appendChild(title);

        const summary = domain.summary || null;
        const goalDescriptions = buildGoalDescriptionMap(summary);

        if (summary) {
          section.appendChild(renderSummaryTable(summary));
        }

        const detailTitle = document.createElement('div');
        detailTitle.className = 'detail-title';
        detailTitle.textContent = DETAIL_TITLE_TEXT;
        section.append(detailTitle);

        section.appendChild(renderDetailTable(domain.details || {}, goalDescriptions));

        return section;
      }

      function renderSummaryTable(summary) {
        const table = document.createElement('table');
        table.className = 'summary-table';

        const headers = Array.isArray(summary.headers) ? summary.headers : [];
        const rows = Array.isArray(summary.rows) ? summary.rows : [];

        const thead = document.createElement('thead');
        const headerRow = document.createElement('tr');
        headers.forEach((header, index) => {
          const th = document.createElement('th');
          
          // ç¬¬ä¸€å€‹è¡¨é ­å–®å…ƒæ ¼ä½¿ç”¨å°è§’ç·šæ¨£å¼
          if (index === 0) {
            th.className = 'diagonal-header';
            // è™•ç†è¡¨é ­æ–‡å­—ï¼Œé æœŸæ ¼å¼ç‚º "å­¸ç¿’é¢å‘\né ˜åŸŸèƒ½åŠ›" æˆ–åŒ…å« <br>
            const headerText = header || '';
            // åˆ†éš”æ›è¡Œç¬¦æˆ– <br> æ¨™ç±¤
            const lines = headerText
              .split(/\n|<br\s*\/?>/i)
              .map(line => line.trim())
              .filter(line => line);
            
            if (lines.length >= 2) {
              // æœ‰å…©è¡Œæ–‡å­—ï¼Œä½¿ç”¨å°è§’ç·šä½ˆå±€
              // ç¬¬ä¸€è¡Œæ”¾å³ä¸Šè§’ï¼ˆå­¸ç¿’é¢å‘ï¼‰
              const topRight = document.createElement('span');
              topRight.className = 'top-right';
              topRight.textContent = lines[0];
              
              // ç¬¬äºŒè¡Œæ”¾å·¦ä¸‹è§’ï¼ˆé ˜åŸŸèƒ½åŠ›ï¼‰
              const bottomLeft = document.createElement('span');
              bottomLeft.className = 'bottom-left';
              bottomLeft.textContent = lines[1];
              
              th.appendChild(topRight);
              th.appendChild(bottomLeft);
            } else {
              // åªæœ‰ä¸€è¡Œæˆ–æ²’æœ‰æ–‡å­—ï¼Œç›´æ¥é¡¯ç¤º
              th.innerHTML = headerText;
            }
          } else {
            th.innerHTML = header || '';
          }
          
          headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);
        table.appendChild(thead);

        const tbody = document.createElement('tbody');
        
        // è¨ˆç®—æ¯å€‹èƒ½åŠ›éœ€è¦çš„ rowspan
        const abilityCounts = [];
        let currentAbility = null;
        let currentCount = 0;
        
        rows.forEach((row, index) => {
          const ability = row.ability || '';
          
          if (ability && ability !== currentAbility) {
            // æ–°çš„èƒ½åŠ›é–‹å§‹
            if (currentAbility !== null) {
              abilityCounts.push({ ability: currentAbility, count: currentCount, startIndex: index - currentCount });
            }
            currentAbility = ability;
            currentCount = 1;
          } else if (!ability && currentAbility) {
            // ç©ºèƒ½åŠ›ï¼Œå±¬æ–¼ä¸Šä¸€å€‹èƒ½åŠ›çš„å»¶çºŒ
            currentCount++;
          } else if (ability) {
            // ç›¸åŒèƒ½åŠ›
            currentCount++;
          }
          
          // æœ€å¾Œä¸€è¡Œ
          if (index === rows.length - 1 && currentAbility !== null) {
            abilityCounts.push({ ability: currentAbility, count: currentCount, startIndex: index - currentCount + 1 });
          }
        });

        // è¿½è¹¤æ¯å€‹æ¬„ä½è¢« rowspan ä½”ç”¨çš„æƒ…æ³
        // rowspanTracker[colIndex] = å‰©é¤˜è¦è·³éçš„è¡Œæ•¸
        const rowspanTracker = {};

        rows.forEach((row, rowIndex) => {
          const tr = document.createElement('tr');

          // æª¢æŸ¥é€™ä¸€è¡Œæ˜¯å¦éœ€è¦æ¸²æŸ“èƒ½åŠ›å–®å…ƒæ ¼
          const abilityInfo = abilityCounts.find(info => info.startIndex === rowIndex);
          if (abilityInfo) {
            const abilityTd = document.createElement('td');
            abilityTd.className = 'ability-cell';
            abilityTd.textContent = abilityInfo.ability;
            if (abilityInfo.count > 1) {
              abilityTd.setAttribute('rowspan', abilityInfo.count);
            }
            tr.appendChild(abilityTd);
          } else if (!row.ability) {
            // å¦‚æœé€™è¡Œæ²’æœ‰èƒ½åŠ›ä¸”ä¸æ˜¯èµ·å§‹è¡Œï¼Œä¸æ·»åŠ èƒ½åŠ›å–®å…ƒæ ¼ï¼ˆè¢« rowspan è¦†è“‹ï¼‰
          } else if (row.ability) {
            // æœ‰èƒ½åŠ›ä½†ä¸æ˜¯èµ·å§‹è¡Œï¼Œèªªæ˜æ˜¯æ–°çš„èƒ½åŠ›çµ„
            const abilityTd = document.createElement('td');
            abilityTd.className = 'ability-cell';
            abilityTd.textContent = row.ability;
            tr.appendChild(abilityTd);
          }

          // è¨ˆç®—å¯¦éš›éœ€è¦æ¸²æŸ“çš„æ¬„ä½æ•¸ï¼ˆåŒ…æ‹¬è¢« colspan å±•é–‹çš„ï¼‰
          let totalColumns = headers.length - 1; // æ¸›å»èƒ½åŠ›æ¬„
          let dataColIndex = 0; // JSON ä¸­çš„æ¬„ä½ç´¢å¼•
          let renderColIndex = 0; // å¯¦éš›è¦æ¸²æŸ“çš„æ¬„ä½ä½ç½®ï¼ˆè€ƒæ…®è¢« rowspan ä½”ç”¨çš„ï¼‰
          
          while (renderColIndex < totalColumns && dataColIndex < (Array.isArray(row.cells) ? row.cells.length : 0)) {
            // æª¢æŸ¥é€™å€‹æ¬„ä½æ˜¯å¦è¢«ä¸Šä¸€è¡Œçš„ rowspan ä½”ç”¨
            if (rowspanTracker[renderColIndex] && rowspanTracker[renderColIndex] > 0) {
              // é€™å€‹æ¬„ä½è¢«ä½”ç”¨ï¼Œè·³éæ¸²æŸ“ä½†è¦æª¢æŸ¥ JSON æ•¸æ“š
              // JSON ä¸­å°æ‡‰ä½ç½®æ‡‰è©²æ˜¯ç©ºé™£åˆ—
              rowspanTracker[renderColIndex]--;
              renderColIndex++;
              dataColIndex++; // åŒæ™‚å¢åŠ  dataColIndexï¼Œå› ç‚º JSON ä¸­é€™å€‹ä½ç½®æ˜¯ç©ºé™£åˆ—
              continue;
            }
            
            // æ¸²æŸ“é€™å€‹æ¬„ä½
            const cellItems = Array.isArray(row.cells) && row.cells[dataColIndex] ? row.cells[dataColIndex] : [];
            const td = renderSummaryCell(cellItems);
            tr.appendChild(td);
            
            // æª¢æŸ¥æ˜¯å¦æœ‰ rowspanï¼Œå¦‚æœæœ‰å°±è¨˜éŒ„
            if (cellItems[0] && cellItems[0].rowspan && cellItems[0].rowspan > 1) {
              const rowspanValue = cellItems[0].rowspan;
              // è¨˜éŒ„é€™å€‹æ¬„ä½åœ¨æ¥ä¸‹ä¾†çš„ (rowspan - 1) è¡Œè¦è¢«è·³é
              rowspanTracker[renderColIndex] = rowspanValue - 1;
            }
            
            // å¦‚æœé€™å€‹å–®å…ƒæ ¼æœ‰ colspanï¼Œè·³éå¾ŒçºŒè¢«ä½”æ“šçš„æ¬„ä½
            let colspanValue = 1;
            if (cellItems[0] && cellItems[0].colspan && cellItems[0].colspan > 1) {
              colspanValue = cellItems[0].colspan;
              renderColIndex += colspanValue;
            } else {
              renderColIndex++;
            }
            
            dataColIndex++;
          }

          tbody.appendChild(tr);
        });
        table.appendChild(tbody);

        return table;
      }

      function renderSummaryCell(cellItems) {
        const td = document.createElement('td');

        if (!Array.isArray(cellItems) || !cellItems.length) {
          td.classList.add('empty-cell');
          return td;
        }

        // æª¢æŸ¥ç¬¬ä¸€å€‹é …ç›®æ˜¯å¦æœ‰ colspanï¼Œå¦‚æœæœ‰å°±è¨­ç½®åˆ° td ä¸Š
        if (cellItems[0] && cellItems[0].colspan && cellItems[0].colspan > 1) {
          td.setAttribute('colspan', cellItems[0].colspan);
        }

        // æª¢æŸ¥ç¬¬ä¸€å€‹é …ç›®æ˜¯å¦æœ‰ rowspanï¼Œå¦‚æœæœ‰å°±è¨­ç½®åˆ° td ä¸Š
        if (cellItems[0] && cellItems[0].rowspan && cellItems[0].rowspan > 1) {
          td.setAttribute('rowspan', cellItems[0].rowspan);
        }

        cellItems.forEach((item) => {
          const wrapper = document.createElement('div');
          wrapper.className = 'summary-cell-item';

          if (item.goal) {
            const goalDiv = document.createElement('div');
            goalDiv.className = 'goal-code';
            goalDiv.textContent = item.goal;
            wrapper.appendChild(goalDiv);
            
            // æ·»åŠ å¯é»æ“Šæ¨£å¼å’Œé»æ“Šäº‹ä»¶
            wrapper.classList.add('clickable-goal');
            wrapper.style.cursor = 'pointer';
            wrapper.addEventListener('click', () => {
              const targetElement = document.getElementById(`goal-${item.goal}`);
              if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                // æ·»åŠ é«˜äº®æ•ˆæœ
                targetElement.classList.add('highlight-goal');
                setTimeout(() => {
                  targetElement.classList.remove('highlight-goal');
                }, 2000);
              }
            });
          }

          if (item.description) {
            const descDiv = document.createElement('div');
            descDiv.className = 'goal-desc';
            descDiv.textContent = item.description;
            wrapper.appendChild(descDiv);
          }

          td.appendChild(wrapper);
        });

        return td;
      }

      function buildGoalDescriptionMap(summary) {
        const map = {};

        if (!summary || !Array.isArray(summary.rows)) {
          return map;
        }

        summary.rows.forEach((row) => {
          if (!Array.isArray(row.cells)) {
            return;
          }

          row.cells.forEach((cell) => {
            if (!Array.isArray(cell)) {
              return;
            }

            cell.forEach((item) => {
              if (item && item.goal && !Object.prototype.hasOwnProperty.call(map, item.goal)) {
                map[item.goal] = item.description || '';
              }
            });
          });
        });

        return map;
      }

      function showToast(message) {
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.innerHTML = `
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M16.6667 5L7.5 14.1667L3.33333 10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>${message}</span>
        `;
        document.body.appendChild(toast);
        
        setTimeout(() => {
          toast.remove();
        }, 3000);
      }

      function createCopyButton(textToCopy) {
        const button = document.createElement('button');
        button.className = 'copy-button';
        button.innerHTML = `
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8 4V16C8 17.1046 8.89543 18 10 18H18C19.1046 18 20 17.1046 20 16V7.24162C20 6.7034 19.7831 6.18789 19.3982 5.81161L16.6569 3.11612C16.2698 2.73702 15.7484 2.52309 15.2045 2.52309H10C8.89543 2.52309 8 3.41852 8 4.52309V4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M16 18V20C16 21.1046 15.1046 22 14 22H6C4.89543 22 4 21.1046 4 20V9C4 7.89543 4.89543 7 6 7H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        `;
        button.title = 'é»æ“Šè¤‡è£½';
        
        button.addEventListener('click', async (e) => {
          e.stopPropagation();
          try {
            await navigator.clipboard.writeText(textToCopy);
            
            // æ·»åŠ åˆ°å‰ªè²¼ç°¿æ­·å²è¨˜éŒ„ï¼ˆé¿å…é‡è¤‡ï¼‰
            if (!clipboardHistory.includes(textToCopy)) {
              clipboardHistory.push(textToCopy);
              updateClipboardUI();
            }
            
            showToast('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿');
          } catch (err) {
            console.error('è¤‡è£½å¤±æ•—:', err);
            showToast('è¤‡è£½å¤±æ•—');
          }
        });
        
        return button;
      }

      function renderDetailTable(details, goalDescriptions = {}) {
        const table = document.createElement('table');
        table.className = 'detail-table';

        const ageHeaders = Array.isArray(details.ageHeaders) ? details.ageHeaders : [];
        const goals = Array.isArray(details.goals) ? details.goals : [];
        
        // å¹´é½¡å°æ‡‰ä»£ç¢¼æ˜ å°„
        const ageToCode = {
          '2-3æ­²': 'å¹¼',
          '3-4æ­²': 'å°',
          '4-5æ­²': 'ä¸­',
          '5-6æ­²': 'å¤§'
        };

        const thead = document.createElement('thead');
        const headerRow = document.createElement('tr');

        const goalTh = document.createElement('th');
        goalTh.style.width = '180px';
        goalTh.textContent = 'èª²ç¨‹ç›®æ¨™';
        headerRow.appendChild(goalTh);

        ageHeaders.forEach((age) => {
          const th = document.createElement('th');
          th.className = 'age-header';
          th.textContent = age;
          headerRow.appendChild(th);
        });

        thead.appendChild(headerRow);
        table.appendChild(thead);

        const tbody = document.createElement('tbody');

        goals.forEach((goal) => {
          const indicators = Array.isArray(goal.indicators) ? goal.indicators : [];

          indicators.forEach((indicator, index) => {
            const tr = document.createElement('tr');
            
            if (index === indicators.length - 1) {
              tr.className = 'goal-group-last';
            }

            if (index === 0) {
              const goalTd = document.createElement('td');
              goalTd.className = 'goal-col';
              
              // æ·»åŠ  ID ç”¨æ–¼è·³è½‰
              if (goal.goalId) {
                goalTd.id = `goal-${goal.goalId}`;
              }
              
              const goalCode = document.createElement('div');
              goalCode.className = 'goal-code';
              goalCode.textContent = goal.goalId || '';
              goalTd.appendChild(goalCode);

              const goalDescText = goal.goalId && Object.prototype.hasOwnProperty.call(goalDescriptions, goal.goalId)
                ? goalDescriptions[goal.goalId]
                : '';

              if (goalDescText) {
                const goalDesc = document.createElement('div');
                goalDesc.className = 'goal-desc';
                goalDesc.textContent = goalDescText;
                goalTd.appendChild(goalDesc);
              }

              if (indicators.length > 1) {
                goalTd.setAttribute('rowspan', indicators.length);
              }
              tr.appendChild(goalTd);
            }

            ageHeaders.forEach((age, ageIndex) => {
              const descTd = document.createElement('td');
              descTd.className = 'desc-col';
              
              const value = indicator.ages && Object.prototype.hasOwnProperty.call(indicator.ages, age)
                ? indicator.ages[age]
                : '';
              
              // å¦‚æœå–®å…ƒæ ¼ç‚ºç©ºï¼Œæ·»åŠ  empty-cell é¡
              if (!value || value.trim() === '') {
                descTd.classList.add('empty-cell');
              }
              
              // æª¢æŸ¥æ˜¯å¦ç‚ºç®­é ­æŒ‡æ¨™
              if (value === 'âŸ¶' || value.trim() === 'âŸ¶') {
                descTd.classList.add('arrow-cell');
                const arrowDiv = document.createElement('div');
                arrowDiv.className = 'arrow-indicator';
                descTd.appendChild(arrowDiv);
                
                // ç‚ºç®­é ­æŒ‡æ¨™æ·»åŠ è¤‡è£½æŒ‰éˆ•ï¼ˆè¤‡è£½å»¶çºŒå‰ä¸€å€‹å¹´é½¡æ®µçš„å…§å®¹ï¼‰
                if (indicator.code && ageToCode[age]) {
                  const adjustedCode = indicator.code.replace(/[å¹¼å°ä¸­å¤§](\/[å¹¼å°ä¸­å¤§])*/, ageToCode[age]);
                  
                  // å°‹æ‰¾å‰ä¸€å€‹å¹´é½¡æ®µçš„æè¿°æ–‡å­—
                  let previousDesc = '';
                  for (let i = ageIndex - 1; i >= 0; i--) {
                    const prevAge = ageHeaders[i];
                    const prevValue = indicator.ages && Object.prototype.hasOwnProperty.call(indicator.ages, prevAge)
                      ? indicator.ages[prevAge]
                      : '';
                    // æ‰¾åˆ°ç¬¬ä¸€å€‹ä¸æ˜¯ç®­é ­çš„å…§å®¹
                    if (prevValue && prevValue !== 'âŸ¶' && prevValue.trim() !== 'âŸ¶') {
                      previousDesc = prevValue;
                      break;
                    }
                  }
                  
                  // çµ„åˆä»£ç¢¼å’Œå»¶çºŒçš„æè¿°
                  const copyText = previousDesc ? `${adjustedCode} ${previousDesc}` : adjustedCode;
                  const copyBtn = createCopyButton(copyText);
                  descTd.appendChild(copyBtn);
                }
              } else if (value) {
                // åªåœ¨æœ‰å…§å®¹æ™‚é¡¯ç¤ºä»£ç¢¼å’Œæè¿°
                // æ ¹æ“šå¹´é½¡æ›¿æ›ä»£ç¢¼ä¸­çš„å¹¼/å°/ä¸­/å¤§
                let adjustedCode = '';
                if (indicator.code && ageToCode[age]) {
                  const indicatorCode = document.createElement('div');
                  indicatorCode.className = 'indicator-code';
                  // æ›¿æ›ä»£ç¢¼ä¸­çš„ å¹¼/å°/ä¸­/å¤§ éƒ¨åˆ†
                  adjustedCode = indicator.code.replace(/[å¹¼å°ä¸­å¤§](\/[å¹¼å°ä¸­å¤§])*/, ageToCode[age]);
                  indicatorCode.textContent = adjustedCode;
                  descTd.appendChild(indicatorCode);
                }
                
                const desc = document.createElement('div');
                desc.className = 'indicator-desc';
                desc.textContent = value;
                descTd.appendChild(desc);
                
                // æ·»åŠ è¤‡è£½æŒ‰éˆ•ï¼ˆç›´æ¥æ·»åŠ åˆ° tdï¼Œä¸æ˜¯ wrapperï¼‰
                const copyText = adjustedCode ? `${adjustedCode}\n${value}` : value;
                const copyBtn = createCopyButton(copyText);
                descTd.appendChild(copyBtn);
              }

              tr.appendChild(descTd);
            });

            tbody.appendChild(tr);
          });
        });

        table.appendChild(tbody);
        return table;
      }

      // ============= å·¥å…·åˆ—åŠŸèƒ½ =============
      
      function initToolbar() {
        // åˆå§‹åŒ–å°èˆªé¸å–®
        populateNavSelect();
        setupScrollListener();
        
        // è¨­ç½®å‰ªè²¼ç°¿æŒ‰éˆ•äº‹ä»¶
        document.getElementById('clipboardBtn').addEventListener('click', (e) => {
          openClipboardModal(e);
        });
        
        // é»æ“Š modal å¤–éƒ¨é—œé–‰
        document.addEventListener('click', (e) => {
          const modal = document.getElementById('clipboardModal');
          const clipboardContent = document.querySelector('.clipboard-content');
          const clipboardBtn = document.querySelector('.clipboard-btn');
          
          if (modal.classList.contains('show') && 
              !clipboardContent.contains(e.target) && 
              !clipboardBtn.contains(e.target)) {
            closeClipboardModal();
          }
        });
        
        // å…¨éƒ¨è¤‡è£½æŒ‰éˆ•
        document.getElementById('copyAllBtn').addEventListener('click', async () => {
          if (clipboardHistory.length === 0) return;
          
          const allText = clipboardHistory.join('\n\n');
          try {
            await navigator.clipboard.writeText(allText);
            showToast(`å·²è¤‡è£½ ${clipboardHistory.length} å€‹æŒ‡æ¨™`);
          } catch (err) {
            console.error('è¤‡è£½å¤±æ•—:', err);
            showToast('è¤‡è£½å¤±æ•—');
          }
        });
        
        // æ¸…ç©ºæŒ‰éˆ•
        document.getElementById('clearBtn').addEventListener('click', () => {
          if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰å·²è¤‡è£½çš„æŒ‡æ¨™å—ï¼Ÿ')) {
            clipboardHistory = [];
            updateClipboardUI();
            showToast('å·²æ¸…ç©ºå‰ªè²¼ç°¿');
          }
        });
        
        // å°èˆªé¸å–®è®Šæ›´äº‹ä»¶
        document.getElementById('domainNav').addEventListener('change', (e) => {
          const index = parseInt(e.target.value);
          if (!isNaN(index) && domainSections[index]) {
            domainSections[index].element.scrollIntoView({ 
              behavior: 'smooth',
              block: 'start'
            });
          }
        });
      }
      
      function populateNavSelect() {
        const select = document.getElementById('domainNav');
        select.innerHTML = '<option value="">é¸æ“‡é ˜åŸŸ...</option>';
        
        domainSections.forEach((section, index) => {
          const option = document.createElement('option');
          option.value = index;
          option.textContent = section.name;
          select.appendChild(option);
        });
      }
      
      function setupScrollListener() {
        let lastScrollTop = 0;
        let ticking = false;
        
        window.addEventListener('scroll', () => {
          lastScrollTop = window.pageYOffset || document.documentElement.scrollTop;
          
          if (!ticking) {
            window.requestAnimationFrame(() => {
              updateNavSelect(lastScrollTop);
              ticking = false;
            });
            ticking = true;
          }
        });
      }
      
      function updateNavSelect(scrollTop) {
        const select = document.getElementById('domainNav');
        const offset = 100; // åç§»é‡ï¼Œæå‰è§¸ç™¼
        
        for (let i = domainSections.length - 1; i >= 0; i--) {
          const section = domainSections[i];
          const rect = section.element.getBoundingClientRect();
          const elementTop = rect.top + scrollTop;
          
          if (scrollTop >= elementTop - offset) {
            if (select.value !== i.toString()) {
              select.value = i.toString();
            }
            break;
          }
        }
      }
      
      function updateCurrentDomain() {
        // è·å–å½“å‰æ»šåŠ¨ä½ç½®
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        // æ›´æ–°å¯¼èˆªé€‰å•
        updateNavSelect(scrollTop);
      }
      
      function openClipboardModal(event) {
        const modal = document.getElementById('clipboardModal');
        const content = modal.querySelector('.clipboard-content');
        
        // å¦‚æœå·²ç¶“æ‰“é–‹ï¼Œå‰‡é—œé–‰
        if (modal.classList.contains('show')) {
          closeClipboardModal();
          return;
        }
        
        // ç²å–æŒ‰éˆ•çš„å¯¦éš›ä½ç½®ï¼ˆè€ƒæ…®å‹•æ…‹èª¿æ•´ï¼‰
        const button = event.currentTarget;
        const buttonRect = button.getBoundingClientRect();
        
        // è¨ˆç®—æŒ‰éˆ•ä¸­å¿ƒé»
        const buttonCenterX = buttonRect.left + buttonRect.width / 2;
        const buttonTop = buttonRect.top;
        
        // è¨­ç½® modal ä½ç½®ï¼ˆä»¥æŒ‰éˆ•ä¸­å¿ƒé»ç‚ºåŸºæº–ï¼Œè‡ªå‹•è·Ÿéš¨æŒ‰éˆ•ä½ç½®ï¼‰
        content.style.left = `${buttonCenterX}px`;
        content.style.top = `${buttonTop}px`;
        
        modal.classList.add('show');
        updateClipboardList();
      }
      
      function closeClipboardModal() {
        const modal = document.getElementById('clipboardModal');
        
        // æ·»åŠ  closing é¡ä¾†è§¸ç™¼ä¸‹æµ®å‹•ç•«
        modal.classList.add('closing');
        
        // ç­‰å¾…å‹•ç•«å®Œæˆå¾Œç§»é™¤ show å’Œ closing é¡
        setTimeout(() => {
          modal.classList.remove('show', 'closing');
        }, 200); // èˆ‡å‹•ç•«æ™‚é–“ä¸€è‡´
      }
      
      function updateClipboardUI() {
        // æ›´æ–°è¨ˆæ•¸å¾½ç« 
        document.getElementById('clipboardCount').textContent = clipboardHistory.length;
        
        // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
        const hasItems = clipboardHistory.length > 0;
        document.getElementById('copyAllBtn').disabled = !hasItems;
        document.getElementById('clearBtn').disabled = !hasItems;
        
        // æ›´æ–°å‰ªè²¼ç°¿åˆ—è¡¨é¡¯ç¤º
        updateClipboardList();
      }
      
      function updateClipboardList() {
        const listContainer = document.getElementById('clipboardList');
        
        if (clipboardHistory.length === 0) {
          listContainer.innerHTML = `
            <div class="clipboard-empty">
              <div class="clipboard-empty-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width: 48px; height: 48px; fill: #cbd5e0;">
                  <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 16H5V5h2v3h10V5h2v14z"/>
                </svg>
              </div>
              <div>å°šæœªè¤‡è£½ä»»ä½•æŒ‡æ¨™</div>
            </div>
          `;
          return;
        }
        
        // å‰µå»ºè¡¨æ ¼
        let tableHTML = `
          <table class="clipboard-table">
            <thead>
              <tr>
                <th>#</th>
                <th>å­¸ç¿’æŒ‡æ¨™å…§å®¹</th>
              </tr>
            </thead>
            <tbody>
        `;
        
        clipboardHistory.forEach((item, index) => {
          tableHTML += `
            <tr data-index="${index}" title="é»æ“Šè¤‡è£½æ­¤é …">
              <td>${index + 1}</td>
              <td>${item}</td>
            </tr>
          `;
        });
        
        tableHTML += `
            </tbody>
          </table>
        `;
        
        listContainer.innerHTML = tableHTML;
        
        // ç‚ºæ¯è¡Œæ·»åŠ é»æ“Šäº‹ä»¶
        listContainer.querySelectorAll('tbody tr').forEach((row, index) => {
          row.addEventListener('click', async () => {
            const item = clipboardHistory[index];
            try {
              await navigator.clipboard.writeText(item);
              showToast('å·²è¤‡è£½');
            } catch (err) {
              console.error('è¤‡è£½å¤±æ•—:', err);
              showToast('è¤‡è£½å¤±æ•—');
            }
          });
        });
      }
    })();
  </script>
</body>
</html>
